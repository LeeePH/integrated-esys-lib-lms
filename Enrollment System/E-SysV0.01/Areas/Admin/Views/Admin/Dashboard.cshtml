@model E_SysV0._01.Models.AdminDashboardViewModel
@using System.Globalization
@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminAppLayout.cshtml";
    ViewData["Title"] = "Dashboard";

    // Enrollment settings helpers
    var es = Model.EnrollmentSettings;
    var currentSem = es?.Semester ?? "1st Semester";
    var academicYear = es?.AcademicYear ?? "(not set)";
    var enrollmentOpen = es?.IsOpen == true;
    // Derived counts (safe checks)
    var totalEnrolled = Model.Enrolled?.Count ?? 0;
    int enrolled1stYear = ViewBag.Enrolled1stYearCount != null ? Convert.ToInt32(ViewBag.Enrolled1stYearCount) : 0;
    int enrolled2ndYear = ViewBag.Enrolled2ndYearCount != null ? Convert.ToInt32(ViewBag.Enrolled2ndYearCount) : 0;

    // Friendly status
    var enrollmentStatusText = enrollmentOpen ? "Open" : "Closed";
    var enrollmentStatusBadge = enrollmentOpen ? "bg-success" : "bg-secondary";


}

<style>
    /* Unified metric card styles */
    .overview-row {
        margin-bottom: 1.5rem;
    }

    .overview-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
    }

    .overview-card {
        border-radius: 0.75rem;
        padding: 1rem;
        background: linear-gradient(180deg,#ffffff, #fbfdff);
        box-shadow: 0 6px 18px rgba(16,24,40,0.06);
        border: 1px solid rgba(15,23,42,0.04);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 110px;
    }

        .overview-card .meta {
            display: flex;
            align-items: center;
            gap: .75rem;
        }

        .overview-card h5 {
            margin: 0;
            font-size: 0.95rem;
            color: #0f172a;
            font-weight: 600;
        }

    .overview-value {
        font-size: 1.6rem;
        font-weight: 700;
        color: #0b5ed7;
        margin-top: .35rem;
    }

    .overview-sub {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: .25rem;
    }

    .overview-actions {
        margin-top: .6rem;
        display: flex;
        gap: .5rem;
        align-items: center;
    }

    .overview-badge {
        padding: .28rem .6rem;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.78rem;
        color: #fff;
    }

    .icon-circle {
        width: 38px;
        height: 38px;
        background: #eef7ff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        color: #0b5ed7;
        font-size: 1.05rem;
    }
    @@media (max-width: 576px) {
        .overview-value

    {
        font-size: 1.25rem;
    }

    }

    /* Keep previous "metric-card" styles but updated for consistency */
    .metric-card {
        border-radius: 0.65rem;
        padding: 1rem;
        box-shadow: 0 6px 18px rgba(16,24,40,0.04);
        background: #fff;
        border: 1px solid #e9eef8;
    }

    .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: .35rem;
    }

        .metric-header h3 {
            margin: 0;
            font-size: 0.95rem;
            font-weight: 600;
            color: #0b2447;
        }

    .icon-light-blue {
        color: #0b5ed7;
    }

    .icon-green {
        color: #0f9d58;
    }

    .icon-orange {
        color: #ff9800;
    }

    .icon-red {
        color: #dc3545;
    }
</style>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger mb-3">
        @TempData["Error"]
    </div>
}
@if (TempData["Info"] != null)
{
    <div class="alert alert-warning mb-3">
        @TempData["Info"]
    </div>
}

<!-- OVERVIEW ROW: Current Semester / AY / Enrollment Status / Totals -->
<div class="overview-row">
    <div class="overview-cards">
        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-clock"></i></div>
                <div>
                    <h5>Current Semester</h5>
                    <div class="overview-value">@currentSem</div>
                    <div class="overview-sub">Academic cycle in effect</div>
                </div>
            </div>


        </div>

        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-calendar-alt"></i></div>
                <div>
                    <h5>Academic Year</h5>
                    <div class="overview-value">@academicYear</div>
                    <div class="overview-sub">Active academic year</div>
                </div>
            </div>
        </div>

        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-toggle-on"></i></div>
                <div>
                    <h5>Enrollment Status</h5>
                    <div class="overview-value">@enrollmentStatusText</div>
                    <div class="overview-sub">Open / Closed for students</div>
                </div>
            </div>

        </div>

        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-users"></i></div>
                <div>
                    <h5>Total Enrolled</h5>
                    <div class="overview-value">@totalEnrolled</div>
                    <div class="overview-sub">Students currently enrolled</div>
                </div>
            </div>

        </div>
    </div>
</div>
<style>
    /* compact variant for quick counters */
    .overview-cards.small-cards {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: .75rem;
    }

        .overview-cards.small-cards .overview-card {
            padding: .6rem;
            min-height: 86px;
        }

        .overview-cards.small-cards .icon-circle {
            width: 34px;
            height: 34px;
            font-size: .95rem;
        }

    .overview-value.small {
        font-size: 1.15rem;
        color: #0b5ed7;
        font-weight: 700;
    }

    .overview-sub.small {
        font-size: .78rem;
        color: #6b7280;
        margin-top: .18rem;
    }

    .overview-actions .btn {
        padding: .2rem .5rem;
        font-size: .78rem;
    }
</style>
<!-- QUICK COUNTERS: 1st Year / 2nd Year / Pending / On Hold / Rejected -->
<div class="overview-row">
    <div class="overview-cards small-cards">
        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-user-graduate"></i></div>
                <div>
                    <h5>1st Year</h5>
                    <div class="overview-value small">@enrolled1stYear</div>
                    <div class="overview-sub small">Freshmen enrolled</div>
                </div>
            </div>

        </div>

        <div class="overview-card">
            <div class="meta">
                <div class="icon-circle"><i class="fas fa-user-check"></i></div>
                <div>
                    <h5>2nd Year</h5>
                    <div class="overview-value small">@enrolled2ndYear</div>
                    <div class="overview-sub small">Sophomores enrolled</div>
                </div>
            </div>

        </div>
    </div>
</div>





<!-- EXISTING METRIC CARDS (kept intact, visually unified by the new CSS) -->
<div class="row metric-cards g-3">
    <div class="col-md-4">
        <div class="card metric-card total">
            <div class="metric-header">
                <h3>1st Sem Pending</h3>
                <i class="fas fa-hourglass-half icon-light-blue"></i>
            </div>
            <h1>@Model.Pending1stSem.Count</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("Pending1stSem", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card metric-card total">
            <div class="metric-header">
                <h3>2nd Sem Pending</h3>
                <i class="fas fa-hourglass-start icon-light-blue"></i>
            </div>
            <h1>@Model.Pending2ndSem.Count</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("Pending2ndSem", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card metric-card">
            <div class="metric-header">
                <h3>Enrolled (1st)</h3>
                <i class="fas fa-user-check icon-green"></i>
            </div>
            <h1>@Model.Enrolled.Count</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("Enrolled", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card metric-card">
            <div class="metric-header">
                <h3>Enrolled (2nd)</h3>
                <i class="fas fa-user-check icon-green"></i>
            </div>
            @{
                int regularCount2 = 0;
                int irregularCount2 = 0;
                try { regularCount2 = ViewBag.Enrolled2ndRegularCount != null ? Convert.ToInt32(ViewBag.Enrolled2ndRegularCount) : 0; } catch { regularCount2 = 0; }
                try { irregularCount2 = ViewBag.Enrolled2ndIrregularCount != null ? Convert.ToInt32(ViewBag.Enrolled2ndIrregularCount) : 0; } catch { irregularCount2 = 0; }
                var total2nd = (ViewBag.Enrolled2ndTotal != null) ? Convert.ToInt32(ViewBag.Enrolled2ndTotal) : (regularCount2 + irregularCount2);
            }
            <h1>@total2nd</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("Enrolled2ndSem", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card metric-card">
            <div class="metric-header">
                <h3>On Hold</h3>
                <i class="fas fa-pause-circle icon-orange"></i>
            </div>
            <h1>@Model.OnHold.Count</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("OnHold", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card metric-card">
            <div class="metric-header">
                <h3>Rejected</h3>
                <i class="fas fa-times-circle icon-red"></i>
            </div>
            <h1>@Model.Rejected.Count</h1>
            <a class="btn btn-primary btn-sm btn-elevated mt-2" href="@Url.Action("Rejected", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>
</div>

<!-- keep remaining dashboard sections (Shifter cards etc.) unchanged -->
<div class="row mt-4 mb-2">
    <div class="col-12">
        <div class="d-flex align-items-center gap-2">
            <h4 class="mb-0">
                <i class="fas fa-exchange-alt me-2 text-warning"></i>
                Shifter Enrollment Requests
            </h4>
            <small class="text-muted">(Students requesting program changes)</small>
        </div>
        <hr class="mt-2 mb-3" />
    </div>
</div>

<div class="row metric-cards g-3">
    <div class="col-md-3">
        <div class="card metric-card" style="border-left: 4px solid #ff9800;">
            <div class="metric-header">
                <h3>Pending Shifter</h3>
                <i class="fas fa-clock" style="color: #ff9800;"></i>
            </div>
            <h1>@ViewBag.PendingShifterCount</h1>
            <a class="btn btn-warning btn-sm btn-elevated mt-2 text-white"
               href="@Url.Action("PendingShifter", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card" style="border-left: 4px solid #28a745;">
            <div class="metric-header">
                <h3>Accepted Shifter</h3>
                <i class="fas fa-check-circle" style="color: #28a745;"></i>
            </div>
            <h1>@ViewBag.AcceptedShifterCount</h1>
            <a class="btn btn-success btn-sm btn-elevated mt-2"
               href="@Url.Action("AcceptedShifter", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card" style="border-left: 4px solid #6c757d;">
            <div class="metric-header">
                <h3>On-Hold Shifter</h3>
                <i class="fas fa-pause-circle" style="color: #6c757d;"></i>
            </div>
            <h1>@ViewBag.OnHoldShifterCount</h1>
            <a class="btn btn-secondary btn-sm btn-elevated mt-2"
               href="@Url.Action("OnHoldShifter", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card" style="border-left: 4px solid #dc3545;">
            <div class="metric-header">
                <h3>Rejected Shifter</h3>
                <i class="fas fa-times-circle" style="color: #dc3545;"></i>
            </div>
            <h1>@ViewBag.RejectedShifterCount</h1>
            <a class="btn btn-danger btn-sm btn-elevated mt-2"
               href="@Url.Action("RejectedShifter", "Admin", new { area = "Admin" })">
                <i class="fas fa-eye me-1"></i> View
            </a>
        </div>
    </div>
</div>