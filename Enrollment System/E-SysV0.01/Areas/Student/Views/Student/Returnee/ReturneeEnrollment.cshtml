@using Microsoft.AspNetCore.Mvc.Rendering
@{
    Layout = "~/Views/Shared/ESys_KioskLayout.cshtml";
    ViewData["Title"] = "Returnee On-site Enrollment";
}

<style>
    
    .required-asterisk::after {
        content: " *";
        color: #dc3545;
    }

    input.input-validation-error, select.input-validation-error, textarea.input-validation-error, .input-validation-error {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 .1rem rgba(220, 53, 69, 0.15);
    }

    .field-validation-error, .validation-summary-errors {
        color: #dc3545;
    }

    .field-validation-valid {
        display: none;
    }

    /* Responsive grid to improve spacing and use full width */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: .75rem 1rem;
        width: 100%;
    }
</style>

<h3>Application Form</h3>
<p>Fill out the form carefully and ensure that all information provided is accurate before submission for re-admission.</p>
<hr />

<div class="d-flex w-100 rounded-2 p-2" style="background-color: #066B99;">
    <img src="/images/student-icon-white.svg" alt="Student Icon" width="30" />
    <h4 class="text-white ms-2">Returnee Enrollment Form</h4>
</div>

<div id="enrollmentStatusAlert" class="alert alert-danger validation-summary-errors mt-3" role="alert">
    <ul class="mb-0">
        <li>
            <span id="enrollmentStatusText">
                Enrollment is open.
            </span>
            <span id="enrollmentCountdown" class="ms-2 fw-bold"></span>
            <span id="enrollmentClosesAt" class="ms-2 text-muted"></span>
        </li>
    </ul>
</div>

<div class="mt-3" style="width: 100%;">
    <h4>Applicant Details</h4>
    <p>Please provide your personal and academic details as a returnee student.</p>
    <hr />

    <form id="returneeForm" action="/ReturneeEnrollment/ReturneeEnrollment" method="post" class="mt-3" novalidate>

        <div class="alert alert-danger" role="alert" style="display:none;">
            Please correct the errors below.
        </div>

        <strong>Personal Details</strong>
        <div class="form-grid mt-1 mb-3">
            <div>
                <label for="LastName" class="form-label mb-1 required-asterisk">Last Name</label>
                <input id="LastName" name="StudentPersonal.LastName" class="rounded-2 p-1 w-100 form-control" required />
                <span data-valmsg-for="StudentPersonal.LastName" class="text-danger small field-validation-error"></span>
            </div>
            <div>
                <label for="FirstName" class="form-label mb-1 required-asterisk">First Name</label>
                <input id="FirstName" name="StudentPersonal.FirstName" class="rounded-2 p-1 w-100 form-control" required />
                <span data-valmsg-for="StudentPersonal.FirstName" class="text-danger small field-validation-error"></span>
            </div>
            <div>
                <label for="MiddleName" class="form-label mb-1 required-asterisk">Middle Name</label>
                <input id="MiddleName" name="StudentPersonal.MiddleName"
                       class="rounded-2 p-1 w-100 form-control"
                       placeholder="Type N/A if not applicable"
                       required />
                <span data-valmsg-for="StudentPersonal.MiddleName" class="text-danger small field-validation-error"></span>
            </div>
        </div>

        <h4>Re-admission Information</h4>
        <p>Please provide details about your previous and current academic enrollment.</p>
        <hr />

        <div class="form-grid mt-1 mb-3">
            <div>
                <label for="StudentID" class="form-label mb-1 required-asterisk">Student ID</label>
                <input id="StudentID" name="StudentAcademic.StudentID" class="rounded-2 p-1 w-100 form-control" required />
                <span data-valmsg-for="StudentAcademic.StudentID" class="text-danger small field-validation-error"></span>
            </div>
            <div>
                <label for="CourseLastEnrolled" class="form-label mb-1 required-asterisk">Program Last Enrolled</label>
                <select id="CourseLastEnrolled" name="StudentAcademic.CourseLastEnrolled" class="p-1 rounded-1 form-select" required>
                    <option value="" disabled selected hidden>-- Select Program --</option>
            
                    <option value="BSECED">BSECED - Early Childhood Education</option>
                    <option value="BSIE">BSIE - Industrial Engineering</option>
                    <option value="BSECE">BSECE - Electronics Engineering</option>
                    <option value="BSECED">BSECED - Early Childhood Education</option>
                    <option value="BSIE">BSIE - Industrial Engineering</option>
                    <option value="BSECE">BSECE - Electronics Engineering</option>
                    <option value="BSECED">BSECED - Early Childhood Education</option>

                    <option value="BSECED">BSECED - Early Childhood Education</option>
                    <option value="BSIE">BSIE - Industrial Engineering</option>
                    <option value="BSECE">BSECE - Electronics Engineering</option>
                </select>
                <span data-valmsg-for="StudentAcademic.CourseLastEnrolled" class="text-danger small field-validation-error"></span>
            </div>
            <div>
                <label for="CourseApplyingFor" class="form-label mb-1 required-asterisk">Program Applying For Re-admission</label>
                <select id="CourseApplyingFor" name="StudentAcademic.CourseApplyingFor" class="p-1 rounded-1 form-select" required>
                    <option value="" disabled selected hidden>-- Select Program --</option>
                    <option value="BSIT">BSIT - Information Technology</option>
                    <option value="BSENTREP">BSENTREP - Entrepreneurship</option>
                    <option value="BSECED">BSECED - Early Childhood Education</option>
                    <option value="BSIE">BSIE - Industrial Engineering</option>
                    <option value="BSECE">BSECE - Electronics Engineering</option>
                </select>
                <span data-valmsg-for="StudentAcademic.CourseApplyingFor" class="text-danger small field-validation-error"></span>
            </div>
        </div>

        <h4>Absence & Shifting Details</h4>
        <hr />

        <div class="mb-3">
            <label for="EnrolledInOtherUniversity" class="form-label mb-1 required-asterisk">
                Have you enrolled in other universities during the period of AWOL/LOA?
                <small class="text-secondary">(If Yes, specify)</small>
            </label>
            <textarea id="EnrolledInOtherUniversity" name="StudentDetails.EnrolledInOtherUniversity"
                      class="rounded-2 p-1 w-100 form-control" rows="2"
                      placeholder="Specify the university name and duration, or enter 'No'. (Required)"
                      required></textarea>
            <span data-valmsg-for="StudentDetails.EnrolledInOtherUniversity" class="text-danger small field-validation-error"></span>
        </div>

        <div class="mb-3">
            <label for="ReasonForStopping" class="form-label mb-1 required-asterisk">Reason why you stopped before</label>
            <textarea id="ReasonForStopping" name="StudentDetails.ReasonForStopping"
                      class="rounded-2 p-1 w-100 form-control" rows="3"
                      placeholder="Please clearly state your reason for stopping enrollment. (Required)"
                      required></textarea>
            <span data-valmsg-for="StudentDetails.ReasonForStopping" class="text-danger small field-validation-error"></span>
        </div>

        <div class="mb-4">
            <label for="ReasonForShifting" class="form-label mb-1">
                If you are applying to shift to another program, reason/s for transfer
            </label>
            <textarea id="ReasonForShifting" name="StudentDetails.ReasonForShifting"
                      class="rounded-2 p-1 w-100 form-control" rows="3"
                      placeholder="Explain your reasons for shifting programs. Leave blank if not shifting."></textarea>
            <span data-valmsg-for="StudentDetails.ReasonForShifting" class="text-danger small field-validation-error"></span>
        </div>


        <p class="pt-2 text-secondary mb-3">
            After submitting, please hand your physical documents to the admin and wait for acceptance/rejection.
        </p>

        <div class="d-flex align-items-center gap-2 mt-3">
            <button id="btnSubmit" type="submit" class="btn text-white" style="background-color: #066B99;">Submit</button>
            <button id="btnClearAll" type="button" class="btn btn-outline-danger ms-auto">Clear all</button>
        </div>
    </form>
</div>
<datalist id="barangays-list"></datalist>

<div class="modal fade" id="feedbackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Submission Status</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-success">Your submission was processed successfully.</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {
        const form = $('#returneeForm');
        const modalElement = document.getElementById('feedbackModal');
        const confirmationModal = new bootstrap.Modal(modalElement);

        form.on('submit', function (e) {
            e.preventDefault();

            if (form[0].checkValidity() === false) {
                $('#submissionError').text('Please fill in all required fields.').show();
                form.addClass('was-validated');
                return;
            }

            $('#submissionError').hide();
            form.removeClass('was-validated');

            confirmationModal.show();
        });

        modalElement.addEventListener('hidden.bs.modal', function () {
            window.location.reload();
        });

        $('#btnClearAll').on('click', function() {
             form[0].reset();
             form.removeClass('was-validated');
             $('#submissionError').hide();
        });
    });
</script>