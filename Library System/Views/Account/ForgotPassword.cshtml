@model SystemLibrary.ViewModels.ForgotPasswordViewModel
@{
    ViewBag.Title = "Forgot Password";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewBag.Title</title>
    <link rel="stylesheet" href="~/css/login.css" />

    <style>
        .info-text {
            color: #666;
            font-size: 14px;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .back-to-login {
            text-align: center;
            margin-top: 20px;
        }

        .back-to-login a {
            color: #4a90e2;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .back-to-login a:hover {
            color: #357abd;
        }

        .success-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .success-modal-overlay.active {
            display: flex;
        }

        .success-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }

        .success-modal-content {
            padding: 40px 30px;
            text-align: center;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px;
        }

        .success-modal h2 {
            color: #28a745;
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 15px 0;
        }

        .success-modal p {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
            margin: 0 0 30px 0;
        }

        .success-modal-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 14px 50px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .success-modal-button:hover {
            background-color: #218838;
        }

        .error-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .error-modal-overlay.active {
            display: flex;
        }

        .error-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .error-modal-content {
            padding: 40px 30px;
            text-align: center;
        }

        .error-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px;
        }

        .error-modal h2 {
            color: #dc3545;
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 15px 0;
        }

        .error-modal p {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
            margin: 0 0 30px 0;
        }

        .error-modal-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 14px 50px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .error-modal-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="login-wrapper">
        <div class="overlay"></div>

        <div class="login-box">
            <div class="text-center">
                <h1 class="login-title">Forgot Password</h1>
                <div class="underline"></div>
            </div>

            <p class="info-text">
                Enter your username and email address. We'll verify your information and allow you to reset your password.
            </p>

            @using (Html.BeginForm("ForgotPassword", "Account", FormMethod.Post))
            {
                    <div class="form-group">
                        <label for="Username">Username</label>
                    @Html.TextBox("Username", null, new { @class = "input-field", placeholder = "Enter your username..." })
                    </div>

                    <div class="form-group">
                        <label for="Email">Email</label>
                    @Html.TextBox("Email", null, new { @class = "input-field", placeholder = "Enter your email...", type = "email" })
                    </div>

                    <button type="submit" class="login-btn">VERIFY & RESET</button>
            }

            <div class="back-to-login">
                <a href="@Url.Action("Login", "Account")">← Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="success-modal-overlay">
        <div class="success-modal">
            <div class="success-modal-content">
                <svg class="success-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#28a745" stroke-width="4"/>
                    <polyline points="30,50 45,65 70,35" fill="none" stroke="#28a745" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h2>Verification Successful</h2>
                <p id="successMessage">Your information has been verified. Redirecting to password reset...</p>
                <button type="button" class="success-modal-button" onclick="redirectToReset()">CONTINUE</button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="error-modal-overlay">
        <div class="error-modal">
            <div class="error-modal-content">
                <svg class="error-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#dc3545" stroke-width="4"/>
                    <line x1="30" y1="30" x2="70" y2="70" stroke="#dc3545" stroke-width="4" stroke-linecap="round"/>
                    <line x1="70" y1="30" x2="30" y2="70" stroke="#dc3545" stroke-width="4" stroke-linecap="round"/>
                </svg>
                <h2>Verification Failed</h2>
                <p id="errorMessage">Invalid username or password. Please try again.</p>
                <button type="button" class="error-modal-button" onclick="closeErrorModal()">TRY AGAIN</button>
            </div>
        </div>
    </div>

    <script>
        var resetToken = null;

        function closeErrorModal() {
            document.getElementById('errorModal').classList.remove('active');
        }

        function redirectToReset() {
            if (resetToken) {
                window.location.href = '/Account/ResetPassword?token=' + resetToken;
            }
        }

        // Close modals when clicking outside
        document.getElementById('errorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeErrorModal();
            }
        });

        window.addEventListener('DOMContentLoaded', function() {
        @if (TempData["SuccessMessage"] != null && TempData["ResetToken"] != null)
        {
            <text>
                    resetToken = '@TempData["ResetToken"]';
                    document.getElementById('successMessage').textContent = '@TempData["SuccessMessage"]';
                    document.getElementById('successModal').classList.add('active');

                    // Auto redirect after 3 seconds
                    setTimeout(function() {
                        redirectToReset();
                    }, 3000);
            </text>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <text>
                    document.getElementById('errorMessage').textContent = '@TempData["ErrorMessage"]';
                    document.getElementById('errorModal').classList.add('active');
            </text>
        }
        });
    </script>
</body>
</html>